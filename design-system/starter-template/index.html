<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>應用程式名稱</title>
    <!-- 自動同步自工作紀錄中心 v2.9.17 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * { font-family: 'Inter', 'Microsoft JhengHei', sans-serif; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideIn { from { opacity: 0; transform: scale(0.95) translateY(-10px); } to { opacity: 1; transform: scale(1) translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.2s ease-out; }
        .animate-slide-in { animation: slideIn 0.2s ease-out; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, createContext, useContext } = React;

        // ========== Firebase 設定 ==========
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        const APP_VERSION = "v1.0.0";
        let app, auth, db;
        try {
            app = firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();
        } catch (e) { console.error('Firebase 初始化失敗:', e); }

        // ========== 通用元件 ==========
        const Button = ({ children, variant = 'primary', size = 'md', disabled, loading, onClick, className = '', ...props }) => {
            const variants = {
                primary: 'bg-blue-600 text-white hover:bg-blue-700',
                secondary: 'bg-white text-slate-600 border border-slate-300 hover:bg-slate-50',
                danger: 'bg-red-600 text-white hover:bg-red-700',
                success: 'bg-emerald-600 text-white hover:bg-emerald-700',
                ghost: 'text-slate-600 hover:bg-slate-100',
            };
            const sizes = { sm: 'px-3 py-1.5 text-sm', md: 'px-4 py-2 text-sm', lg: 'px-6 py-2.5 text-base' };
            return (
                <button disabled={disabled || loading} onClick={onClick}
                    className={`inline-flex items-center justify-center gap-2 rounded-lg font-medium transition disabled:opacity-50 disabled:cursor-not-allowed ${variants[variant]} ${sizes[size]} ${className}`} {...props}>
                    {loading ? <svg className="animate-spin h-4 w-4" viewBox="0 0 24 24"><circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" fill="none" /><path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z" /></svg> : children}
                </button>
            );
        };

        const Card = ({ children, className = '', padding = 'p-6' }) => (
            <div className={`bg-white rounded-xl shadow-sm border border-slate-200 ${padding} ${className}`}>{children}</div>
        );

        const Input = ({ label, required, error, hint, className = '', ...props }) => (
            <div className={className}>
                {label && <label className="block text-xs font-bold text-slate-500 uppercase mb-1">{label} {required && <span className="text-red-500">*</span>}</label>}
                <input className={`w-full p-2.5 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition ${error ? 'border-red-500' : 'border-slate-300'}`} {...props} />
                {hint && !error && <p className="text-xs text-slate-400 mt-1">{hint}</p>}
                {error && <p className="text-xs text-red-500 mt-1">{error}</p>}
            </div>
        );

        const Badge = ({ children, variant = 'default' }) => {
            const variants = {
                default: 'bg-gray-100 text-gray-700 border-gray-200',
                primary: 'bg-blue-100 text-blue-700 border-blue-200',
                success: 'bg-green-100 text-green-700 border-green-200',
                warning: 'bg-yellow-100 text-yellow-700 border-yellow-200',
                danger: 'bg-red-100 text-red-700 border-red-200',
            };
            return <span className={`px-2 py-1 rounded-full text-xs font-bold border ${variants[variant]}`}>{children}</span>;
        };

        // ========== 頁面 ==========
        const LoginPage = () => {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');

            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);
                setError('');
                try { await auth.signInWithEmailAndPassword(email, password); }
                catch (err) { setError('登入失敗：' + err.message); }
                finally { setLoading(false); }
            };

            return (
                <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-slate-100 p-4">
                    <Card className="w-full max-w-md" padding="p-8">
                        <div className="text-center mb-8">
                            <h1 className="text-2xl font-bold text-slate-800">歡迎回來</h1>
                            <p className="text-slate-500 mt-2">請登入您的帳號</p>
                        </div>
                        {error && <div className="mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-600 text-sm">{error}</div>}
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <Input label="電子郵件" type="email" value={email} onChange={(e) => setEmail(e.target.value)} required />
                            <Input label="密碼" type="password" value={password} onChange={(e) => setPassword(e.target.value)} required />
                            <Button type="submit" loading={loading} className="w-full">登入</Button>
                        </form>
                        <p className="text-center text-sm text-slate-500 mt-6">{APP_VERSION}</p>
                    </Card>
                </div>
            );
        };

        const Sidebar = ({ currentPage, setCurrentPage, user, onLogout }) => {
            const navItems = [
                { id: 'dashboard', label: '儀表板', icon: 'home' },
                { id: 'tasks', label: '任務管理', icon: 'file-text' },
                { id: 'settings', label: '設定', icon: 'settings' },
            ];
            return (
                <aside className="w-full md:w-64 bg-slate-900 text-white flex-shrink-0 flex flex-col shadow-xl z-10">
                    <div className="p-6 border-b border-slate-700"><h1 className="text-xl font-bold">應用程式</h1></div>
                    <nav className="flex-1 p-4 space-y-2">
                        {navItems.map(item => (
                            <button key={item.id} onClick={() => setCurrentPage(item.id)}
                                className={`w-full flex items-center gap-3 px-4 py-2.5 rounded-lg transition ${currentPage === item.id ? 'bg-blue-600 text-white shadow-md' : 'text-slate-300 hover:bg-slate-800'}`}>
                                <i data-lucide={item.icon} className="w-5 h-5"></i><span>{item.label}</span>
                            </button>
                        ))}
                    </nav>
                    <div className="p-4 border-t border-slate-700">
                        <p className="text-sm mb-2 truncate">{user?.email}</p>
                        <Button variant="ghost" onClick={onLogout} className="w-full text-slate-300">登出</Button>
                    </div>
                </aside>
            );
        };

        const DashboardPage = () => (
            <div className="p-6">
                <h1 className="text-2xl font-bold text-slate-800 mb-6">儀表板</h1>
                <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    {[{ label: '總數', value: '128' }, { label: '進行中', value: '45' }, { label: '已完成', value: '80' }, { label: '待處理', value: '3' }].map((s, i) => (
                        <Card key={i}><p className="text-sm text-slate-500">{s.label}</p><p className="text-3xl font-bold text-slate-800">{s.value}</p></Card>
                    ))}
                </div>
            </div>
        );

        const App = () => {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [currentPage, setCurrentPage] = useState('dashboard');

            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged((u) => { setUser(u); setLoading(false); });
                return () => unsubscribe();
            }, []);

            useEffect(() => { if (window.lucide) lucide.createIcons(); });

            if (loading) return <div className="min-h-screen flex items-center justify-center bg-slate-100"><svg className="animate-spin h-8 w-8 text-blue-600" viewBox="0 0 24 24"><circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" fill="none" /><path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z" /></svg></div>;
            if (!user) return <LoginPage />;

            return (
                <div className="flex flex-col md:flex-row min-h-screen bg-slate-100">
                    <Sidebar currentPage={currentPage} setCurrentPage={setCurrentPage} user={user} onLogout={() => auth.signOut()} />
                    <main className="flex-1 overflow-auto">{currentPage === 'dashboard' && <DashboardPage />}</main>
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
