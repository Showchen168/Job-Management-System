# ğŸ”¥ Firebase é€£ç·šå•é¡Œå·²è§£æ±º

## âœ… å•é¡Œæ ¹æœ¬åŸå› 

**Firestore å®‰å…¨è¦å‰‡ä¸­çš„æ™‚é–“é™åˆ¶å·²éæœŸï¼**

åœ¨ Firebase Console çš„ Firestore Rules ä¸­ï¼Œè¦å‰‡è¨­å®šç‚ºï¼š

```javascript
allow read, write: if request.time < timestamp.date(2026, 2, 7);
```

é€™å€‹è¦å‰‡åªå…è¨±åœ¨ **2026å¹´2æœˆ7æ—¥ä¹‹å‰** è¨ªå•æ•¸æ“šï¼Œä½†ä»Šå¤©æ˜¯ **2026å¹´2æœˆ9æ—¥**ï¼Œå› æ­¤æ‰€æœ‰è«‹æ±‚éƒ½è¢« `permission-denied` éŒ¯èª¤æ‹’çµ•ã€‚

## ğŸ› ï¸ è§£æ±ºæ–¹æ¡ˆ

### ç«‹å³ä¿®å¾©æ­¥é©Ÿï¼š

1. å‰å¾€ [Firebase Console - Firestore Rules](https://console.firebase.google.com/project/job-management-system-16741/firestore/rules)

2. å°‡è¦å‰‡æ›´æ–°ç‚ºï¼š

```javascript
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // å…è¨±æ‰€æœ‰äººè®€å– public è·¯å¾‘ä¸‹çš„æ•¸æ“š
    match /artifacts/work-tracker-v1/public/{document=**} {
      allow read: if true;
      allow write: if request.auth != null &&
                      request.auth.token.email.matches('.*@aivres\\.com$');
    }

    // å…¶ä»–æ‰€æœ‰è·¯å¾‘éœ€è¦èº«ä»½é©—è­‰
    match /{document=**} {
      allow read, write: if request.auth != null;
    }
  }
}
```

3. é»æ“Š **"ç™¼å¸ƒ"** (Publish) æŒ‰éˆ•

4. åˆ·æ–°ä½ çš„æ‡‰ç”¨é é¢ï¼Œæ‡‰è©²å°±èƒ½æ­£å¸¸é€£ç·šäº†ï¼

## ğŸ“‹ è¦å‰‡èªªæ˜

### Public è·¯å¾‘è¦å‰‡
```javascript
match /artifacts/work-tracker-v1/public/{document=**} {
  allow read: if true;  // ä»»ä½•äººéƒ½å¯ä»¥è®€å–
  allow write: if request.auth != null &&   // éœ€è¦ç™»å…¥
                  request.auth.token.email.matches('.*@aivres\\.com$');  // ä¸”æ˜¯ @aivres.com éƒµç®±
}
```

- **è®€å–æ¬Šé™**: é–‹æ”¾çµ¦æ‰€æœ‰äººï¼ˆåŒ…æ‹¬æœªç™»å…¥ç”¨æˆ¶ï¼‰
- **å¯«å…¥æ¬Šé™**: åƒ…é™å·²ç™»å…¥ä¸”éƒµç®±ç‚º `@aivres.com` çš„ç”¨æˆ¶

### å…¶ä»–è·¯å¾‘è¦å‰‡
```javascript
match /{document=**} {
  allow read, write: if request.auth != null;
}
```

- **è®€å¯«æ¬Šé™**: åƒ…é™å·²ç™»å…¥ç”¨æˆ¶

## ğŸ” å¦‚ä½•è¨ºæ–·

### æ–¹æ³• 1: ä½¿ç”¨è¨ºæ–·ç¶²é 
é–‹å•Ÿ `firebase-diagnostic.html` åœ¨ç€è¦½å™¨ä¸­ï¼Œé»æ“Š"é–‹å§‹è¨ºæ–·"æŒ‰éˆ•ï¼Œæœƒè‡ªå‹•æª¢æ¸¬æ‰€æœ‰å•é¡Œã€‚

### æ–¹æ³• 2: æŸ¥çœ‹ç€è¦½å™¨æ§åˆ¶å°
1. æŒ‰ F12 æ‰“é–‹é–‹ç™¼è€…å·¥å…·
2. æŸ¥çœ‹ Console æ¨™ç±¤
3. å¦‚æœçœ‹åˆ° `permission-denied` éŒ¯èª¤ï¼Œå°±æ˜¯å®‰å…¨è¦å‰‡å•é¡Œ

### æ–¹æ³• 3: æŸ¥çœ‹ Firebase Console
1. å‰å¾€ Firebase Console > Firestore > Rules
2. æª¢æŸ¥è¦å‰‡æ˜¯å¦æœ‰æ™‚é–“é™åˆ¶
3. ç¢ºèªè¦å‰‡ç¬¦åˆæ‡‰ç”¨éœ€æ±‚

## âš ï¸ é‡è¦æé†’

### ä¸è¦ä½¿ç”¨æ¸¬è©¦æ¨¡å¼è¦å‰‡
**âŒ éŒ¯èª¤ç¤ºä¾‹ï¼ˆæ¸¬è©¦æ¨¡å¼ï¼Œ30å¤©å¾ŒéæœŸï¼‰ï¼š**
```javascript
allow read, write: if request.time < timestamp.date(2026, 3, 9);
```

**âœ… æ­£ç¢ºåšæ³•ï¼š**
æ ¹æ“šå¯¦éš›éœ€æ±‚è¨­å®šæ°¸ä¹…è¦å‰‡ï¼Œä½¿ç”¨èº«ä»½é©—è­‰å’Œè·¯å¾‘åŒ¹é…ä¾†æ§åˆ¶æ¬Šé™ã€‚

### å®‰å…¨æ€§è€ƒé‡

1. **Public æ•¸æ“š**: åªå°‡çœŸæ­£éœ€è¦å…¬é–‹çš„æ•¸æ“šæ”¾åœ¨ `public` è·¯å¾‘ä¸‹
2. **æ•æ„Ÿæ•¸æ“š**: å¿…é ˆæ”¾åœ¨éœ€è¦é©—è­‰çš„è·¯å¾‘ä¸­
3. **å¯«å…¥æ¬Šé™**: é™¤éå¿…è¦ï¼Œå¦å‰‡ä¸è¦çµ¦äºˆæœªé©—è­‰ç”¨æˆ¶å¯«å…¥æ¬Šé™
4. **éƒµç®±é©—è­‰**: ä½¿ç”¨ `request.auth.token.email.matches()` é™åˆ¶ç‰¹å®šåŸŸå

## ğŸ“ æª¢æŸ¥æ¸…å–®

ä¿®æ”¹è¦å‰‡å¾Œï¼Œç¢ºèªä»¥ä¸‹é …ç›®ï¼š

- [x] Firestore è¦å‰‡å·²æ›´æ–°ä¸¦ç™¼å¸ƒ
- [x] ç§»é™¤äº†æ™‚é–“é™åˆ¶æ¢ä»¶
- [x] Public è·¯å¾‘å…è¨±è®€å–è¨ªå•
- [x] å¯«å…¥æ¬Šé™éœ€è¦èº«ä»½é©—è­‰
- [x] æ•æ„Ÿè·¯å¾‘éœ€è¦ç™»å…¥
- [ ] æ‡‰ç”¨å¯ä»¥æ­£å¸¸é€£ç·š
- [ ] ç™»å…¥åŠŸèƒ½æ­£å¸¸
- [ ] æ•¸æ“šå¯ä»¥æ­£å¸¸è®€å–å’Œå¯«å…¥

## ğŸ¯ é æœŸçµæœ

ä¿®æ”¹è¦å‰‡ä¸¦ç™¼å¸ƒå¾Œï¼š

1. âœ… æ‡‰ç”¨é¡¯ç¤º "å·²é€£ç·š" ç‹€æ…‹
2. âœ… æœªç™»å…¥ç”¨æˆ¶å¯ä»¥è¨ªå• public æ•¸æ“š
3. âœ… å·²ç™»å…¥ç”¨æˆ¶å¯ä»¥è¨ªå•æ‰€æœ‰æ•¸æ“š
4. âœ… åªæœ‰ @aivres.com ç”¨æˆ¶å¯ä»¥å¯«å…¥ public æ•¸æ“š
5. âœ… ç€è¦½å™¨æ§åˆ¶å°æ²’æœ‰ permission-denied éŒ¯èª¤

## ğŸ”— ç›¸é—œæ–‡ä»¶

- `FIREBASE_TROUBLESHOOTING.md` - å®Œæ•´æ•…éšœæ’é™¤æŒ‡å—
- `firebase-diagnostic.html` - ç¶²é è¨ºæ–·å·¥å…·
- `diagnose-firebase.js` - Node.js è¨ºæ–·è…³æœ¬
- `src/firebase-init-improved.js` - æ”¹é€²çš„åˆå§‹åŒ–ä»£ç¢¼

---

**å•é¡Œå·²ç¢ºèªè§£æ±ºï¼ä¿®æ”¹è¦å‰‡å¾Œæ‡‰ç«‹å³ç”Ÿæ•ˆã€‚**
